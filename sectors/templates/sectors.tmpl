//@version=5
// @description Lightweight library for mapping ETFs to their Top 10 holdings.
library("SectorLib", overlay=false)

// ──────────────
// 1. Sector Membership Helpers (Internal)
// ──────────────
{{- range $sector, $stocks := .Sectors }}
f_is{{ $sector }}(stock) =>
    bool found = false
    switch stock
        {{- range $s := $stocks }}
        "{{ $s }}" => found := true
        {{- end }}
    found
{{ end }}

// ──────────────
// 2. Exported Functions
// ──────────────

// @function Returns the sector ticker for a given stock.
// @param stock (string)
export f_getSector(stock) =>
    string result = "unknown"
    switch
        {{- range $sector, $stocks := .Sectors }}
        f_is{{ $sector }}(stock) => result := "{{ $sector }}"
        {{- end }}
    result

// @function Returns the number of holdings for a specific sector.
// @param sector (string)
export f_getNumHoldings(sector) =>
    int count = 0
    switch sector
        {{- range $sector, $stocks := .Sectors }}
        "{{ $sector }}" => count := {{ len $stocks }}
        {{- end }}
    count

// @function Returns a specific holding by index for a sector.
// @param sector (string)
// @param idx (int)
export f_getHolding(sector, idx) =>
    string ticker = na
    switch sector
        {{- range $sector, $stocks := .Sectors }}
        "{{ $sector }}" =>
            switch idx
                {{- range $i, $s := $stocks }}
                {{ $i }} => ticker := "{{ $s }}"
                {{- end }}
        {{- end }}
    ticker

// @function Returns an array of all sector tickers.
export f_getAllSectors() =>
    array.from({{- $first := true }}{{- range $sector, $_ := .Sectors }}{{- if $first }}{{ $first = false }}"{{ $sector }}"{{ else }}, "{{ $sector }}"{{ end }}{{- end }})