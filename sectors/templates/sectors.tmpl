// ==========================================
// Step 1: Strip Exchange Prefix
cleanT_step1 = str.replace_all(syminfo.ticker, ".*:", "")
// Step 2: Strip Suffixes like .T or -B
cleanT = str.replace_all(cleanT_step1, "[.\\-].*$", "")

// Use empty strings instead of na for safety in request.security
string currentSector = "unknown"
string s01 = "", string s02 = "", string s03 = "", string s04 = "", string s05 = ""
string s06 = "", string s07 = "", string s08 = "", string s09 = "", string s10 = ""

// --- Index Sector Group ---
if cleanT == "SPY" or cleanT == "QQQ" or cleanT == "IWM" or cleanT == "DIA"
    currentSector := cleanT, s01 := "SPY", s02 := "QQQ", s03 := "IWM", s04 := "DIA"
{{ range $sector, $stocks := .Sectors -}}
else if cleanT == "{{ $sector }}"{{ range $stocks }} or cleanT == "{{ . }}"{{ end }}
    currentSector := "{{ $sector }}"
    {{- range $i, $s := $stocks }}
    s{{ if lt $i 9 }}0{{ end }}{{ add $i 1 }} := "{{ $s }}"
    {{- end }}
{{ end }}
else
    currentSector := "unknown"